#!/usr/bin/env python

##############################################################################
##
## $Id: AppletRun,v 1.6 2002/11/12 23:41:07 riemer Exp $
##
## Copyright (C) 2002 Tilo Riemer <riemer@lincvs.org>
## All rights reserved. 
##
## Redistribution and use in source and binary forms, with or without
## modification, are permitted provided that the following conditions
## are met:
##
## 1. Redistributions of source code must retain the above copyright
##    notice, this list of conditions and the following disclaimer.
## 2. Redistributions in binary form must reproduce the above copyright
##    notice, this list of conditions and the following disclaimer in the
##    documentation and/or other materials provided with the distribution.
## 3. The name of the author may not be used to endorse or promote products
##    derived from this software without specific prior written permission. 
##
## THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
## IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
## OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
## IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
## INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
## NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
## DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
## THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
## (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
## THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
##
###############################################################################


import findrox
import rox
from rox import g
import sys
from rox import applet
import time
import commands

apm_cmd = "/usr/sbin/apm"


time_display = g.Label("")

def update_time():
	time_display.set_text(time.ctime())
	return 1

apm_display = g.Label("")
apm_display.set_justify(g.JUSTIFY_RIGHT)


#das label kann mehrere zeilen darstellen, man koennte die zeit also auch anzeigen
def update_apm():
	life_percent = "0%"
	life_time    = "00:00"
	
	#we reset LC_ALL because we need the english output from apm
	res = commands.getoutput("env LC_ALL=C " + apm_cmd)
	lines = res.split("\n")
	for i in lines:
		if i.find("battery life") > 0:
			life_res = i.split(":")
			life_percent = life_res[1]
			
		if i.find("battery time") > 0:
			life_res = i.split(": ")
			life_time = life_res[1]
			
	apm_display.set_text(life_percent + "\n" + life_time)
	return 1


#update_time()
update_apm()


if len(sys.argv) > 1:
	main = applet.Applet(sys.argv[1])
else:
	main = rox.Window()


main.set_border_width(8)
main.add(apm_display)
main.show_all()

#g.timeout_add( 1000, update_time)
g.timeout_add(10000, update_apm)


rox.mainloop()
